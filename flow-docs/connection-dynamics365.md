---
title: Dynamics 365 (オンライン) を使用したフローの作成 | Microsoft Docs
description: Dynamics 365 接続および Microsoft Flow によって有用なワークフローを作成する
services: ''
suite: flow
documentationcenter: na
author: Mattp123
manager: anneta
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/06/2017
ms.author: matp
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: e5abf1dd6f1f1d1dd6853aa552460694aebddd61
ms.sourcegitcommit: 31b578972f00e6ab2e50ea0b674142199b3b7a35
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/25/2019
ms.locfileid: "54905692"
---
# <a name="create-a-flow-by-using-dynamics-365-online"></a>Dynamics 365 (オンライン) を使用したフローの作成
Dynamics 365 コネクタを使用すると、Dynamics 365 またはその他のサービスでイベントが発生し、これにより Dynamics 365 またはその他のサービスでアクションが実行されたときに、開始されるフローを作成することができます。 

Microsoft Flow では、お気に入りのアプリとサービスの間のワークフローを自動化して、ファイルの同期、通知の受信、データ収集などを行うことができます。 詳細については、「[Microsoft Flow を使ってみる](getting-started.md)」をご覧ください。

> [!IMPORTANT] 
> フロー トリガーを起動するには、フローと共に Dynamics 365 顧客エンゲージメント エンティティが使用する**変更の追跡**を有効にする必要があります。 詳細情報: [変更の追跡を有効にしてデータ同期を制御する](https://docs.microsoft.com/dynamics365/customer-engagement/admin/enable-change-tracking-control-data-synchronization) 

## <a name="create-a-flow-from-a-template"></a>テンプレートからフローを作成する
さまざまなテンプレートが用意されています。このいずれかを使用してフローを作成することができます。次に例を示します。

* オブジェクトが Dynamics 365 で作成されている場合は、SharePoint でリスト項目を作成します。
* Excel の表から Dynamics 365 の潜在顧客レコードを作成します。
* Dynamics 365 のアカウントを Dynamics 365 for Operations の顧客にコピーします。

テンプレートからフローを作成するには、次の手順に従います。

1. [Microsoft Flow Web サイト](https://flow.microsoft.com/)にサインインします。
2. **[サービス]** をクリックまたはタップし、**[Dynamics 365]** をクリックまたはタップします。
3. 複数のテンプレートが利用できます。 作業を開始するには、目的のテンプレートを選択します。

## <a name="create-a-task-from-a-lead"></a>潜在顧客からタスクを作成する
必要とする内容に対応するテンプレートが提供されていない場合は、一からフローを作成します。 このチュートリアルでは、Dynamics 365 で潜在顧客が作成されるたびに Dynamics 365 でタスクを作成する方法を説明します。

1. [Microsoft Flow Web サイト](https://flow.microsoft.com/)にサインインします。
2. **[マイ フロー]** をクリックまたはタップし、**[一から作成]** をクリックまたはタップします。
3. フロー トリガーの一覧で、**[Dynamics 365 - レコードが作成されたとき]** をクリックまたはタップします。
4. メッセージが表示されたら、Dynamics 365 にサインインします。
5. **[組織名]** で、フローによりリッスンする Dynamics 365 インスタンスを選択します。
6. **[エンティティ名]** で、リッスンするエンティティを選択します。これはフローを開始するトリガーとして機能します。
   
     このチュートリアルでは、**[潜在顧客]** を選択します。
   
    ![フロー詳細](./media/connection-dynamics365/flow-details.png)
    > [重要] Dynamics 365 エンティティでフローをトリガーするためには、エンティティの定義の**変更追跡**が有効になっている必要があります。 「[変更の追跡を有効にしてデータ同期を制御する](https://docs.microsoft.com/dynamics365/customer-engagement/admin/enable-change-tracking-control-data-synchronization)」をご覧ください。
    
7. **[新しいステップ]** をクリックまたはタップし、**[アクションの追加]** をクリックまたはタップします。
8. **[Dynamics 365 – 新しいレコードの作成]** をクリックまたはタップします。
9. **組織名**で、フローによりレコードを作成する Dynamics 365 インスタンスを選択します。 そのインスタンスは、イベントがトリガーされるインスタンスと同じである必要はありません。
10. **[エンティティ名]** で、イベントの発生時にレコードを作成するエンティティを選択します。
    
     このチュートリアルでは、**[タスク]** を選択します。
11. **[サブジェクト]** ボックスが表示されます。 このボックスをクリックまたはタップすると、動的コンテンツ ウィンドウが表示されます。このウィンドウでは次のフィールドのいずれかを選択できます。
    
    * **[姓]**。 このフィールドを選択すると、タスクの作成時にタスクの **[サブジェクト]** フィールドに潜在顧客の姓が挿入されます。
    * **[トピック]**。 このフィールドを選択すると、タスクの作成時にタスクの **[サブジェクト]** フィールドに潜在顧客の **[トピック]** フィールドが挿入されます。
    
    このチュートリアルでは、**[トピック]** を選択します。
    
    ![フローのトピックの追加](./media/connection-dynamics365/flow-addtopic.png)
    
    > **ヒント:** 動的コンテンツ ウィンドウで、**[表示数を増やす]** をクリックまたはタップすると、エンティティに関連付けられたフィールドがさらに表示されます。 たとえば、タスクの **[サブジェクト]** フィールドに、潜在顧客の **[会社名]**、**[顧客]**、**[説明]**、または **[電子メール]** フィールドを取り込むことができます。
    > 
    > 
12. **[フローの作成]** をクリックまたはタップします。

## <a name="create-a-wunderlist-task-from-a-dynamics-365-task"></a>Dynamics 365 タスクから Wunderlist タスクを作成する
このチュートリアルでは、Dynamics 365 でタスクが作成されるたびに [Wunderlist](https://www.wunderlist.com) にタスクを作成する方法を説明します。 Wunderlist は、To Do リストの作成、アラームの追加、または用事の追跡で使用できるインターネットベースのサービスです。

1. [Microsoft Flow Web サイト](https://flow.microsoft.com/)にサインインします。
2. **[マイ フロー]** をクリックまたはタップし、**[一から作成]** をクリックまたはタップします。
3. フロー トリガーの一覧で、**[Dynamics 365 - レコードが作成されたとき]** をクリックまたはタップします。
4. **[組織名]** で、フローによりリッスンする Dynamics 365 インスタンスを選択します。
5. **[エンティティ名]** で、リッスンするエンティティを選択します。これはフローを開始するトリガーとして機能します。
   
    このチュートリアルでは、**[タスク]** を選択します。
6. **[新しいステップ]** をクリックまたはタップし、**[アクションの追加]** をクリックまたはタップします。
7. 「 *タスクの作成* 」と入力し、**[Wunderlist – タスクの作成]** をクリックまたはタップします。
8. **[リスト ID]** で、**[受信トレイ]** を選択します。
9. **[タイトル]** で、動的コンテンツ ウィンドウの **[サブジェクト]** を選択します。
10. **[フローの作成]** をクリックまたはタップします。  

## <a name="trigger-based-logic"></a>トリガー ベースのロジック
**[レコードが作成されたとき]**、**[レコードが更新されたとき]**、**[レコードが削除されたとき]** などのトリガーによって、イベントの発生から数分以内にフローが開始されます。  ごくまれに、フローがトリガーされるまでに最大 2 時間かかることがあります。

トリガーが発生すると、フローは通知を受け取りますが、フローはアクションの実行時に存在するデータに対して実行されます。  たとえば、新しいレコードが作成されたときにフローがトリガーされ、フローが実行される前にレコードを 2 回更新した場合、フローは最新のデータに対して 1 回だけ実行されます。

## <a name="specify-advanced-options"></a>詳細なオプションを指定する
フローにステップを追加する場合は、**[詳細オプションの表示]** をクリックまたはタップして、フロー内でのデータのフィルター処理の方法を制御するフィルターまたは並べ替えクエリを追加することができます。

たとえば、フィルター クエリを使用してアクティブな連絡先のみを取得したり、それらを姓に基づいて並べ替えたりすることができます。 そのためには、OData フィルター クエリ「**statuscode eq 1**」を入力し、動的コンテンツ ウィンドウから **[姓]** を選択します。 フィルターおよび並べ替えクエリの詳細については、「[MSDN: $filter](https://msdn.microsoft.com/library/gg309461.aspx#Anchor_1)」および「[MSDN: $orderby](https://msdn.microsoft.com/library/gg309461.aspx#Anchor_2)」を参照してください。

  ![フローの並べ替えクエリ](./media/connection-dynamics365/flow-orderby-query.png)

### <a name="best-practices-when-using-advanced-options"></a>詳細なオプションを使用する場合のベスト プラクティス
フィールドに値を追加する場合は、値を入力するか、動的コンテンツ ウィンドウからいずれか 1 つを選択するかにかかわらず、フィールドの種類を照合する必要があります。

| フィールドの種類 | 使用する方法 | 参照先 | Name (名前) | データ型 |
| --- | --- | --- | --- | --- |
| テキスト フィールド |テキスト フィールドには、1 行のテキスト、またはテキスト型のフィールドである動的コンテンツが必要です。 たとえば、**[カテゴリ]** フィールド、**[サブカテゴリ]** フィールドなどがあります。 |**[設定]** > **[カスタマイズ]** > **[システムのカスタマイズ]** > **[エンティティ]** > **[タスク]** > **[フィールド]** |**カテゴリ** |**単一行のテキスト** |
| 整数フィールド |一部のフィールドには、整数、または整数型フィールドである動的コンテンツが必要です。 たとえば、**[達成率]**、**[期間]** などがあります。 |**[設定]** > **[カスタマイズ]** > **[システムのカスタマイズ]** > **[エンティティ]** > **[タスク]** > **[フィールド]** |**percentcomplete** |**整数** |
| 日付フィールド |一部のフィールドには、mm/dd/yyyy 形式で入力した日付、または日付型フィールドである動的コンテンツが必要です。 たとえば、**[作成日]**、**[開始日]**、**[実際の開始日]**、**[前回の保留時間]**、**[実際の終了日]**、**[期限]** などがあります。 |**[設定]** > **[カスタマイズ]** > **[システムのカスタマイズ]** > **[エンティティ]** > **[タスク]** > **[フィールド]** |**createdon** |**日付と時刻** |
| レコード ID と参照タイプの両方を必要とするフィールド |別のエンティティ レコードを参照するフィールドには、レコード ID と参照タイプの両方が必要です。 |**[設定]** > **[カスタマイズ]** > **[システムのカスタマイズ]** > **[エンティティ]** > **[アカウント]** > **[フィールド]** |**accountid** |**主キー** |

### <a name="more-examples-of-fields-that-require-both-a-record-id-and-lookup-type"></a>レコード ID と参照タイプの両方を必要とするフィールドのその他の例
ここでは、前の表を拡張して、動的コンテンツ リストから選択した値では機能しないフィールドの例を示します。 これらのフィールドには、PowerApps でフィールドに入力されたレコード ID と参照タイプの両方が必要です。

* **[所有者]** と **[所有者の種類]**。
  
  * **[所有者]** フィールドには、有効なユーザーまたはチーム レコード ID を入力する必要があります。
  * **[所有者の種類]** には、**systemusers** または **teams** を指定する必要があります。
* **[顧客]** と **[顧客の種類]**。
  
  * **[顧客]** フィールドには、有効なアカウントまたは連絡先レコード ID を入力する必要があります。
  * **[顧客の種類]** には、**accounts** または **contacts** を指定する必要があります。
* **[関連]** と **[関連の種類]**。
  
  * **[関連]** フィールドには、有効なレコード ID (アカウント レコード ID や連絡先レコード ID など) を入力する必要があります。
  * **[関連の種類]** には、レコードの参照タイプ (**accounts** や **contacts** など) を指定する必要があります。

次の例では、タスクの **[関連]** フィールドにレコード ID を追加して、この ID に対応するアカウント レコードを追加します。

  ![フローのレコード ID およびタイプ アカウント](./media/connection-dynamics365/flow-recordid-account.png)

また、この例では、ユーザーのレコード ID に基づいて特定のユーザーにタスクを割り当てます。

  ![フローのレコード ID およびタイプ ユーザー](./media/connection-dynamics365/flow-recordid-user.png)

レコード ID の検索方法については、次の「[レコード ID の検索](#find-the-records-id)」をご覧ください。

> **重要:** フィールドの説明が "内部使用のみ" になっている場合、フィールドに値は含まれません。 これらのフィールドには、**渡ったパス**、**追加パラメーター**、**タイム ゾーンの規則のバージョン番号**が含まれます
> 
> 

## <a name="find-the-records-id"></a>レコード ID の検索
1. Dynamics 365 Web アプリケーションで、アカウント レコードなどのレコードを開きます。
2. 操作ツール バーの **[ポップ アウト]**
    ![ポップアップ レコード](./media/connection-dynamics365/popout.png) をクリックまたはタップします (または、**[リンクを電子メールで送る]** をクリックまたはタップして完全な URL を既定の電子メール プログラムにコピーします)。
   
    Web ブラウザーのアドレス バーで、URL のエンコード文字 %7b と %7d の間にレコード ID が表示されます。
   
   ![レコード ID](./media/connection-dynamics365/recordid.png)

## <a name="related-topics"></a>関連トピック
[フローのトラブルシューティング](fix-flow-failures.md)

[組織における Flow の Q & A](organization-q-and-a.md)

[よく寄せられる質問](frequently-asked-questions.md)

