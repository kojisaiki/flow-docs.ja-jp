---
title: PowerApps でのワークフローのステージとステップの構成| MicrosoftDocs
description: ワークフローのステップを構成する方法について説明します。
ms.custom: ''
ms.date: 06/27/2018
ms.reviewer: ''
ms.service: flow
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
author: Mattp123
ms.assetid: 0b47dfd5-76db-464f-90c0-c64a0173dcdd
caps.latest.revision: 18
ms.author: matp
manager: kvivek
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 9ebdb1eddaea1f2fd7918c968879f5da37c287fe
ms.sourcegitcommit: 9ecf4956320d465a3bf618b79a9023b729d33c89
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2019
ms.locfileid: "57462857"
---
# <a name="configure-workflow-stages-and-steps"></a>ワークフローのステージとステップを構成する

ワークフローを設計するとき、ステージとステップで実行するロジックを含めることができます。  
  
 **ステージ**  
 ステージによって、ワークフローのロジックが読み取りやすく、説明しやすくなります。 ただし、ステージは、ロジックすなわちワークフローの動作には影響しません。 1 つのプロセスに複数のステージがある場合、プロセス内のすべてのステップは 1 つのステージに含まれる必要があります。  
  
 **ステップ**  
 ステップはワークフロー内のビジネス ロジックの単位です。 ステップには、条件、アクション、他のステップ、またはこれらの組み合わせを含めることができます。  
  
<a name="BKMK_ActionsWorkflowProcessesCanPerform"></a>  
 
## <a name="actions-that-workflow-processes-can-perform"></a>ワークフロー プロセスで実行できるアクション  

 ワークフロー プロセスは、次の表に示すアクションを実行できます。  
  
|アクション|説明|  
|------------|-----------------|  
|**レコードを作成する**|エンティティについて新しいレコードを作成し、選択した値を属性に割り当てます。|  
|**レコードの更新**|ワークフローの実行対象のレコード、そのレコードに N:1 リレーションシップで関連付けられているすべてのレコード、または前のステップで作成されたすべてのレコードを更新できます。|  
|**レコードの割り当て**|ワークフローの実行対象のレコード、そのレコードに N:1 リレーションシップで関連付けられているすべてのレコード、または前のステップで作成されたすべてのレコードを割り当てできます。|  
|**電子メールの送信**|電子メールを送信します。 新しいメール メッセージを作成するか、メール テンプレートを使用するかを選択できます。テンプレートは、ワークフローの実行対象のレコードのエンティティ、そのエンティティに N:1 リレーションシップで関連付けられているすべてのエンティティ、または前のステップで作成されたすべてのレコードのエンティティについて構成されています。|  
|**子ワークフローの開始**|子ワークフローとして構成されたワークフロー プロセスを開始します。|  
|**状態の変更**|プロセスの実行対象のレコード、そのレコードに N:1 リレーションシップで関連付けられているすべてのレコード、または前のステップで作成されたすべてのレコードの状態を変更できます。|  
|**ワークフローの停止**|現在のワークフローを停止します。 **[成功]** または **[取り消し済み]** の状態を設定し、ステータス メッセージを指定できます。<br /><br /> リアルタイム ワークフローがイベントで構成されているとき、ワークフローを停止して状態を [取り消し済み] にすると、イベントのアクションが完了できなくなります。 詳しくは、「[リアルタイム ワークフローを使用する](configure-workflow-steps.md#BKMK_SynchronousWorkflows)」をご覧ください。|  
|**カスタム ステップ**|開発者は、アクションを定義するカスタム ワークフロー ステップを作成できます。 既定ではカスタム ステップは使用できません。|  
  
### <a name="setting-record-values"></a>レコードの値を設定する  

 レコードを作成するときにレコードの値を設定できます。 レコードを更新するときは、値を設定、追加、増分、減分、または消去できます。  
  
 **[プロパティの設定]** を選択すると、エンティティの既定フォームを表示するダイアログが開きます。  
  
 ダイアログの下部では、フォーム内に存在しないその他のフィールドの一覧を確認できます。  
  
 どのフィールドにも、静的な値を設定でき、それがワークフローによって設定されます。  
  
 ダイアログの右側にある**フォーム アシスタント**では、現在のレコードのコンテキストに基づいて値を設定または追加できます。 これには、エンティティの N:1 (多対一) リレーションシップからアクセスできる関連レコードの値が含まれます。  
  
 **フォーム アシスタント**で使用できるオプションは、フォームで選択したフィールドによって異なります。 動的な値を設定すると、動的なデータが含まれることを示す "置換フィールド" と呼ばれる、黄色のプレース ホルダーが表示されます。 値を削除する必要がある場合は、置換フィールドを選択して削除します。 テキスト フィールドでは、静的なデータと動的なデータを組み合わせて使用することができます。  
  
 動的な値の場合、設定したい値がフィールドまたは関連エンティティにあるかどうかはっきりわかりません。 実際にいくつものフィールドを設定して試すか、値を設定してから緑色の矢印を使用して順序を並び替えることができます。 最初のフィールドに値がない場合には、2 番目のフィールドというように順に試行されます。 どのフィールドにもデータがない場合に、使用する既定値を指定できます。  
  
<a name="BKMK_SettingConditionsForWorkflowActions"></a>   

## <a name="setting-conditions-for-workflow-actions"></a>ワークフロー アクションの条件を設定する  

 多くの場合、適用するアクションは条件によって異なります。 ワークフロー プロセスでは、条件を設定して、目的の結果を取得するために分岐ロジックを作成する方法がいくつかあります。 ワークフロー プロセスの実行対象のレコードや、そのレコードに対して N:1 リレーションシップで関連付けられているすべてのレコードの値、またはプロセス内の値を確認できます。  
  
|条件の種類|説明|  
|--------------------|-----------------|  
|**条件の確認**|論理 "if-\<condition> then" ステートメント。<br /><br /> ワークフローの実行対象のレコード、そのレコードに N:1 リレーションシップで関連付けられているすべてのレコード、または前のステップで作成されたすべてのレコードの現在の値を確認できます。 これらの値に基づいて、条件が true の場合に追加のステップを定義できます。<br /><br /> "if-\<condition> then" ステートメントで使用できる演算子は、**Equals**、**Does Not Equal**、**Contains Data**、**Does Not Contain Data**、**Under**、**Not Under** です。 **注:** **Under** と **Not Under** は階層演算子です。 階層的な関係付けが定義されているエンティティに対してのみ使用できます。 階層的な関係付けが定義されていないエンティティに対してこれらの演算子を使用しようとすると、次のエラー メッセージが表示されます。You’re using a hierarchical operator on an entity that doesn’t have a hierarchical relationship defined.  Either make the entity hierarchical (by marking a relationship as hierarchical) or use a different operator.\(階層的な関係付けが定義されていないエンティティに対して階層演算子を使用しています。エンティティの階層を作成する (階層的なリレーションシップをマークする) か、別の演算子を使用してください。\) 階層的な関係付けについて詳しくは、「[階層的に関連するデータの定義とクエリ](/powerapps/maker/common-data-service/define-query-hierarchical-data)」をご覧ください。 表の後のスクリーンショットは、**Under** および **Not Under** 階層演算子を使用するワークフロー プロセスの定義例です。|  
|**条件分岐**|論理 "else-if-then" ステートメント。エディターでは "Otherwise, if \<condition> then:" というテキストが使用されます。<br /><br /> 前に定義した条件の確認を選択し、条件分岐を追加して、条件の確認で false が返されたときの追加ステップを定義できます。|  
|**既定のアクション**|論理 "else" ステートメント。 エディターでは、テキスト "Otherwise:" が使用されます。<br /><br /> 前に定義した条件の確認、条件分岐、待機条件、または並列待機分岐を選択し、既定のアクションを使用して、条件または分岐要素で定義されている条件に一致しないすべてのケースに対するステップを定義できます。|  
|**待機条件**|条件に定義された基準が満たされるまで、バックグラウンド ワークフローを一時停止できます。 待機条件の基準が満たされると、ワークフローが自動的に再開されます。<br /><br /> リアルタイム ワークフローは待機条件を使用できません。|  
|**並列待機分岐**|バックグラウンド ワークフローのために、最初の基準が満たされた場合のみに実行される一連の追加ステップを指定して、代替の待機条件を定義します。 並列待機分岐を使用すると、ワークフロー ロジックに時間制限を設定できます。 待機条件に定義された基準が満たされるまで、ワークフローが無期限に待機することを防ぎます。|  
|**カスタム ステップ**|開発者は、条件を定義するカスタム ワークフロー ステップを作成できます。 既定ではカスタム ステップは使用できません。|  
  
 次のスクリーンショットには、**Under** および **Not Under** 階層演算子を含むワークフロー プロセス定義の例が含まれます。 この例では、2 つのアカウントのグループに 2 つの異なる割引を適用します。 **[ステップの追加]** で、**[条件の確認]** を選択して、**Under** または **Not Under**演算子を含む **if-then** 条件を指定しています。 最初の **if-then** 条件は、Alpine Ski House アカウントの **Under** (下) のすべてのアカウントに適用されます。 これらのアカウントは、商品とサービスの購入で 10% の割引を受けられます。 2 番目の **if-then** 条件は、Alpine Ski House アカウントの **Not Under** (下にない) すべてのアカウントに適用され、それらのアカウントは 5% の割引を受けます。 次に、**[レコードの更新]** を選択して、条件に基づいてアクションを実行することを定義しています。  
  
 ![Under&#47;Not Under 演算子を含むワークフロー プロセス](media/wfp-under-not-under.PNG "Under/Not Under 演算子を含むワークフロー プロセス")  
  
<a name="BKMK_SynchronousWorkflows"></a>   

## <a name="using-real-time-workflows"></a>リアルタイム ワークフローを使用する  

 リアルタイム ワークフローを構成できますが、慎重に使用する必要があります。 一般的にはバックグラウンド ワークフローをお勧めします。これを使用すると、サーバー上のリソースが利用可能になったときに自動で適用させることができるためです。 サーバーが行う必要がある処理が円滑になり、システムを使うすべてのユーザーにとって最適なパフォーマンスが維持されるために役立ちます。 デメリットは、バックグラウンド ワークフローによって定義されたアクションはすぐに実行されないことです。 いつ適用されるか予測できませんが、通常は数分間かかります。 ビジネス プロセスのほとんどの自動化において、これは問題ありません。システムを使用するユーザーは、プロセスが実行されていることを意識する必要がないためです。  
  
 リアルタイム ワークフローを使用するのは、ビジネス プロセスにおいてプロセスの結果をだれかがすぐに見る必要がある場合です。または、操作を取り消す必要がある場合です。 たとえば、レコードが最初に保存されるときに特定の既定値を設定する必要がある場合や、一部のレコードが削除されないことを保証する必要がある場合です。  
  
### <a name="converting-between-real-time-and-background-workflows"></a>リアルタイム ワークフローとバックグラウンド ワークフローを変換する  

 ツールバーの **[バックグラウンド ワークフローに変換]** を選択して、リアルタイム ワークフローをバックグラウンド ワークフローに変換できます。  
  
 ツールバーの **[リアルタイムバックグラウンド ワークフローに変換]** を選択して、バックグラウンド ワークフローをリアルタイム ワークフローに変換できます。 バックグラウンド ワークフローが待機条件を使用していると無効になり、待機条件を削除するまでアクティブ化できなくなります。  
  
### <a name="initiating-real-time-workflows-before-or-after-status-changes"></a>状態変更の前後にリアルタイム ワークフローを開始する  

 リアルタイム ワークフローに対して **[自動プロセスのオプション]** を構成すると、状態変更イベントに関する **[Start When]\(開始のタイミング\)** オプションで、状態変更時について **[After]\(後\)** または **[Before]\(前\)** を選択できるようになります。 既定のオプションは **[After]\(後\)** です。  
  
 **[Before]\(前\)** を選択すると、状態変更のデータが保存される前に、ワークフローのロジックを適用するように指定されます。 これにより、操作の後で他のロジックが適用される前に、値を確認することができ、それ以降のロジックの実行を行わないようにすることができます。 たとえば、プラグインまたはカスタム ワークフロー アクションに追加のロジックがあり、別のシステム上でのアクションを開始する場合があります。 さらなる処理を停止することにより、外部システムが影響を受けるケースを回避できます。 このイベントの前にリアルタイム ワークフローを適用することは、操作が取り消されたときに、データを保存した可能性がある他のワークフローまたはプラグインのアクションをロールバックする必要がないことを意味します。  
  
### <a name="using-the-stop-workflow-action-with-real-time-workflows"></a>リアルタイム ワークフローで [ワークフローの停止] アクションを使用する  

 ワークフローで **[ワークフローの停止]** アクションを適用するとき、状態条件 (**[成功]** または **[取り消し済み]** のいずれか) を指定できます。 状態を [取り消し済み] に設定すると、操作が行われません。 アクション停止ステータス メッセージのテキストを含むエラー メッセージが、**[ビジネス プロセス エラー]** という見出しでユーザーに表示されます。  
  
## <a name="next-steps"></a>次のステップ  
 [プロセスを含むカスタム ビジネス ロジックの作成](guide-staff-through-common-tasks-processes.md)   
 [ワークフロー プロセスの概要](workflow-processes.md)   
 [ワークフロー プロセスの監視と管理](monitor-manage-processes.md)   
 [ワークフロー プロセスのベスト プラクティス](best-practices-workflow-processes.md)
